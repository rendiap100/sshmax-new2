#!/bin/bash

# Mendapatkan tanggal dari server
dateFromServer=$(curl -v --insecure --silent https://google.com/ 2>&1 | grep Date | sed -e 's/< Date: //')
biji=$(date +"%Y-%m-%d" -d "$dateFromServer")

# Membersihkan layar
clear

# Mengambil daftar klien dan menampilkannya
clients=$(grep -E "^#! " "/etc/xray/config.json" | cut -d ' ' -f 2-3)

# Mengecek apakah ada klien yang terdaftar
NUMBER_OF_CLIENTS=$(echo "$clients" | wc -l)
if [[ ${NUMBER_OF_CLIENTS} == '0' ]]; then
    clear
    echo "Anda tidak memiliki klien yang ada!"
    exit 1
fi

clear
echo "TAMPILKAN INFORMASI AKUN XRAY VMESS"
echo "Silakan pilih klien yang ingin ditampilkan informasinya"
echo "==============================="

# Menampilkan daftar klien
echo "$clients" | nl -s ') '

# Memilih klien
read -rp "Pilih klien [1-${NUMBER_OF_CLIENTS}]: " CLIENT_NUMBER

# Memastikan nomor yang dipilih valid
if [[ $CLIENT_NUMBER -ge 1 && $CLIENT_NUMBER -le $NUMBER_OF_CLIENTS ]]; then
    # Mendapatkan informasi klien sesuai dengan nomor yang dipilih
    selected_client=$(echo "$clients" | sed -n "${CLIENT_NUMBER}p")
    user=$(echo "$selected_client" | cut -d ' ' -f 1)
    exp=$(echo "$selected_client" | cut -d ' ' -f 2)

    # Mengambil ID berdasarkan nama pengguna
    uuid=$(grep -E "\"email\": \"$user\"" "/etc/xray/config.json" | cut -d '"' -f 4)

    # Menampilkan informasi akun
    domain=$(cat /etc/xray/domain)

    echo -e "\e[33m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
    echo -e "\\E[40;1;37m        Informasi Akun Xray/Vmess        \E[0m"
    echo -e "\e[33m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
    echo -e "Nama Pengguna   : ${user}"
    echo -e "Domain          : ${domain}"
    echo -e "ID              : ${uuid}"
    echo -e "Batas Waktu     : ${exp}"
    echo -e "\e[33m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
else
    echo "Nomor klien yang dipilih tidak valid!"
fi

# Menunggu input sebelum kembali ke menu
read -n 1 -s -r -p "Tekan tombol apa saja untuk kembali ke menu"
menu
